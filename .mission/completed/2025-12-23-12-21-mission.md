# MISSION

type: WET
track: 2
iteration: 1
status: completed
completed_at: 2025-12-23T12:21:30.000Z

## INTENT
Make `m init` idempotent to preserve existing .mission/backlog.md and .mission/metrics.md when switching AI agents

## SCOPE
internal/templates/templates.go
internal/templates/templates_test.go

## PLAN
- [x] Create markdown parsing functions to extract user content from existing backlog.md and metrics.md
- [x] Modify WriteTemplates function to merge existing user data with new template structure
- [x] Parse backlog.md: extract entries under "DECOMPOSED INTENTS", "REFACTORING OPPORTUNITIES", "FUTURE ENHANCEMENTS"
- [x] Parse metrics.md: extract actual values from "AGGREGATE STATISTICS", "RECENT COMPLETIONS", "PROCESS INSIGHTS"
- [x] Write new templates with preserved user data merged into updated template structure
- [x] Always overwrite governance.md, prompt templates, and library templates (which should change with AI type)
- [x] Update unit tests in templates_test.go to cover idempotent behavior and markdown parsing
- [x] Fix any broken tests caused by the new merging functionality
- [x] Test intelligent merging: init, add entries, update templates, init again with different AI type
- [x] Note: Allow duplication for initial implementation

## VERIFICATION
go test ./internal/templates/ && ./bin/m init --ai q && echo "- Test backlog item" >> .mission/backlog.md && sed -i '' 's/Total Missions.*:/Total Missions**: 5/' .mission/metrics.md && ./bin/m init --ai claude && grep "Test backlog item" .mission/backlog.md && grep "Total Missions**: 5" .mission/metrics.md

## EXECUTION INSTRUCTIONS
⚠️  DO NOT EXECUTE THIS MISSION NOW
- This is PLANNING PHASE only
- Run: `@m.apply` to execute this mission (requires user approval)
- Run: `@m.complete` to archive when finished
